<form id="search-form" class="bg-accent-faded h-10 md:w-1/3 w-1/2 flex items-center ml-4 sm:ml-8 md:ml-16 rounded-sm relative" action="/search/" method="GET">
    <input type="text" name="query" id="search-input" placeholder="Search..." class="flex-1 ml-4 bg-transparent min-w-0" autocomplete="off">
    <button class="p-0" id="search-submit"><img src="/static/img/search.svg" alt="" class="h-10 w-10 px-2 bg-accent rounded-sm"></button>
    <div id="search-sugg-wrp" class="absolute w-screen -ml-4 sm:w-full sm:ml-0 bg-white shadow-lg top-10 pb-2 hidden"></div>
</form>
<!-- <img class="new-entry h-6 ml-6 w-10 bg-white cursor-pointer relative right-48" src="/static/img/add.svg" alt="+" data-type="filter"> -->
<style> 
#advFil{
    display: none;
   
    background-color: white;
    position: absolute;
    left: 25%;
    top: 300%;
    height: 45vh;
    width: 30vw;;
}
@media screen and (max-width: 992px){
    #advFil{
    display: none;
   
    background-color: white;
    position: absolute;
    left: 15%;
    top: 300%;
    height: 30vh;
    width: 50vw;;
}
}
@media screen and (max-width: 600px){
    #advFil{
    display: none;
   
    background-color: white;
    position: absolute;
    left: 15%;
    top: 300%;
    height: 42vh;
    width: 70vw;;
}
}
/* #filtrButton{

} */
</style>
<!-- <div onclick="showfilter()" id="filtrButton" class="new-entry bg-accent px-7 py-1 text-white rounded cursor-pointer absolute left-96 lg:left-1/2 " >Filters</div> -->
<img onclick="showfilter()" class="new-entry h-6 ml-3 relative lg:right-28 xl:right-40 cursor-pointer" src="/static/img/add.svg" alt="+">



<div id="advFil" class="shadow-lg flex flex-col bg-black p-6 w-full md:w-3/5 lg:w-2/5 ">
    <div class="flex flex-row  justify-between">
        <div>Filters</div>
        <svg onclick="hidefilter()" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-8 close-overlay cursor-pointer">
            <path opacity="0.8" d="M1 13L13 1M1 1L13 13" stroke="#111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>  
    </div>
    <div class="pl-24 lg:pl-24 pr-36">
        {{filter.form}}<br>
        <button id="filter-submit" class="bg-blue-600 text-white text-sm rounded px-2 mt-4 mt-1 pb-1">
        Search
        </button>
    </div>
</div>








<template id="search-sugg-cat-tmp">
    <div class="border-t-2 border-gray-200 border-solid pl-8 pr-5 pt-4 pb-6">
        <p class="search-sugg-cat text-gray-400 text-sm my-1">GROUPS</p>
        <div class="search-sugg-entries">

        </div>
    </div>
</template>

<template id="search-sugg-entry-tmp">
    <div>
        <a class="search-sugg-url bg-gray-100 mt-2.5 flex items-center h-16 px-4 rounded-lg cursor-pointer">
            <img src="{{user.account.profile_img_url}}" class="search-sugg-img h-9 w-9 rounded-full object-cover">
            <div class="ml-2">
                <p class="search-sugg-title text-sm">UX/UI Designer</p>
                <p class="search-sugg-subt text-xs">126 members</p>
            </div>
        </a>
    </div>
</template>


<script>
    $(document).ready(function(){
        $('#search-submit').on('click',function(e){
            e.preventDefault()
            var input = $('#search-input').val()
            sessionStorage.setItem('query',input)
            $('#search-form').submit();
        })
        $('#search-input').on('keyup', function(e){
            if(e.keyCode==13){
                var input = $(this).val()
                sessionStorage.setItem('query',input)
                $('#search-form').submit();
            }else{
                $.ajax({
                    url:'/search-sugg/',
                    data:{'query':$(this).val()},
                    dataType:'json',
                    success: (data)=>{
                        if(data.query!=$(this).val())return;
                        console.log(data);
                        $('#search-sugg-wrp').removeClass('hidden');
                        $('#search-sugg-wrp').html("");
                        for(const cat in data.results){
                            if(!data.results[cat].length)continue;
                            const tempWrp = $('#search-sugg-cat-tmp')[0];
                            const d = tempWrp.content.cloneNode(true);
                            $('.search-sugg-cat',d).text(cat.toUpperCase());
                            let ctr=1;
                            for(const entry of data.results[cat]){
                                const tmp = $('#search-sugg-entry-tmp')[0];
                                const p = tmp.content.cloneNode(true);;
                                $('.search-sugg-title',p).text(entry.title);
                                $('.search-sugg-subt',p).text(entry.subtitle);
                                $('.search-sugg-img',p).attr('src',entry.img);
                                $('.search-sugg-url',p).attr('href',entry.url);
                                $('.search-sugg-entries',d).append(p);
                                ctr++;
                                if(ctr>2)break;
                            }
                            $('#search-sugg-wrp').append(d);
                        }
                    },
                    error: (err)=>{
                        console.log(err);
                    }
                })
            }
        })
        $(window).on('click',function(e){
            $('#search-sugg-wrp').addClass('hidden');
        })
    });
    function showfilter(){
        document.getElementById("advFil").style.display = "block";
    }
    function hidefilter(){
        document.getElementById("advFil").style.display = "none";
    }
</script>
